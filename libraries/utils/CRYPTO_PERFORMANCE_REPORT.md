# 加密函数性能对比报告

## 测试概述

本报告对比了 `encryptByPublicKey` / `decryptByPrivateKey`（同步版本）与 `encryptByPublicKeyAsync` / `decryptByPrivateKeyAsync`（异步版本）的性能差异。

测试环境：

- Node.js v22.15.0
- 测试数据范围：1KB - 500MB
- 测试时间：2025-10-21

## 性能测试结果总结

### 加密性能对比

| 数据大小 | 同步版本时间 | 异步版本时间 | 性能提升  | 同步吞吐量 | 异步吞吐量  |
| -------- | ------------ | ------------ | --------- | ---------- | ----------- |
| 1 KB     | 374.71ms     | 250.79ms     | +49.41%   | 0.26 MB/s  | 0.39 MB/s   |
| 10 KB    | 242.54ms     | 167.40ms     | +44.89%   | 2.01 MB/s  | 2.92 MB/s   |
| 100 KB   | 96.47ms      | 61.71ms      | +56.33%   | 20.25 MB/s | 31.65 MB/s  |
| 1 MB     | 137.61ms     | 37.17ms      | +270.20%  | 72.67 MB/s | 269.05 MB/s |
| 10 MB    | 734.40ms     | 56.88ms      | +1191.17% | 68.08 MB/s | 879.06 MB/s |
| 100 MB   | 2.18s        | 843.64ms     | +158.41%  | 91.64 MB/s | 237.07 MB/s |
| 500 MB   | 10.36s       | 922.39ms     | +1023.23% | 48.25 MB/s | 542.07 MB/s |

### 解密性能对比

| 数据大小 | 同步版本时间 | 异步版本时间 | 性能提升 | 同步吞吐量  | 异步吞吐量  |
| -------- | ------------ | ------------ | -------- | ----------- | ----------- |
| 1 KB     | 62.38ms      | 69.98ms      | -10.89%  | 1.57 MB/s   | 1.40 MB/s   |
| 10 KB    | 50.53ms      | 72.61ms      | -30.41%  | 9.66 MB/s   | 6.73 MB/s   |
| 100 KB   | 22.09ms      | 13.17ms      | +67.73%  | 88.42 MB/s  | 148.25 MB/s |
| 1 MB     | 116.53ms     | 16.76ms      | +595.28% | 85.81 MB/s  | 596.52 MB/s |
| 10 MB    | 442.52ms     | 57.37ms      | +671.52% | 112.99 MB/s | 871.52 MB/s |
| 100 MB   | 1.92s        | 211.79ms     | +806.56% | 104.07 MB/s | 944.33 MB/s |
| 500 MB   | 5.20s        | 908.56ms     | +472.15% | 96.16 MB/s  | 550.32 MB/s |

### 数据膨胀率对比

| 数据大小 | 同步版本膨胀率 | 异步版本膨胀率 |
| -------- | -------------- | -------------- |
| 1 KB     | 107.03%        | 113.28%        |
| 10 KB    | 100.70%        | 101.33%        |
| 100 KB   | 100.07%        | 100.13%        |
| 1 MB     | 100.01%        | 100.01%        |
| 10 MB    | 100.00%        | 100.00%        |
| 100 MB   | 100.00%        | 100.00%        |
| 500 MB   | 100.00%        | 100.00%        |

## 关键发现

### 1. 性能优势明显

- **异步版本在大数据场景下表现卓越**：对于 500MB 数据，异步加密比同步快 1023.23%（快 10 倍以上），异步解密比同步快 472.15%（快近 5 倍）
- **吞吐量显著提升**：异步版本在 500MB 时达到 542.07 MB/s 的加密吞吐量和 550.32 MB/s 的解密吞吐量
- **小数据场景**：对于 1KB 以下数据，同步版本在某些情况下可能略有优势，但差异不大

### 2. 技术架构差异

- **同步版本**：直接使用 NaCl 库进行非对称加密
- **异步版本**：使用混合加密方案（非对称加密 AES 密钥 + AES-GCM 加密数据）

### 3. 数据膨胀

- 两种方案的膨胀率都很低，基本可以忽略
- 异步版本在小数据时膨胀率略高，但随数据增大而趋同

## 使用建议

### 推荐使用异步版本的情况：

1. **大数据处理**（> 100KB）：性能优势明显
2. **高吞吐量场景**：需要处理大量数据
3. **服务器应用**：避免阻塞事件循环
4. **文件加密**：处理大文件时

### 可以考虑同步版本的情况：

1. **极小数据**（< 1KB）：性能差异不大
2. **简单脚本**：不需要异步处理的简单场景
3. **兼容性要求**：需要与不支持异步的环境集成

### 性能优化建议：

1. **数据分块**：对于超大文件，考虑分块处理
2. **内存管理**：注意大数据的内存使用
3. **错误处理**：异步版本需要适当的错误处理机制

## 结论

`encryptByPublicKeyAsync` 和 `decryptByPrivateKeyAsync` 在大多数场景下都显著优于其同步版本，特别是在处理大数据时。建议在新项目中优先使用异步版本，除非有特定的兼容性或极小数据处理的考虑。

异步版本的混合加密架构（非对称 + 对称加密）在大数据场景下展现了明显的性能优势，是现代加密应用的推荐选择。
