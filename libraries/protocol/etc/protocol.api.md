## API Report File for "@yuants/protocol"

> Do not edit this file. It is a report generated by [API Extractor](https://api-extractor.com/).

```ts

import { IAccountInfo } from '@yuants/data-model';
import { IDataRecord } from '@yuants/data-model';
import { IDataRecordTypes } from '@yuants/data-model';
import { IPeriod } from '@yuants/data-model';
import { IProduct } from '@yuants/data-model';
import { ITick } from '@yuants/data-model';
import { ITransferOrder } from '@yuants/data-model';
import { JSONSchema7 } from 'json-schema';
import { NativeSubject } from '@yuants/utils';
import { ObservableInput } from 'rxjs';
import { Registry } from '@yuants/prometheus-client';
import { ValidateFunction } from 'ajv';

// Warning: (ae-forgotten-export) The symbol "IAccountTransferAddressContext" needs to be exported by the entry point index.d.ts
//
// @public
export const addAccountTransferAddress: (ctx: IAccountTransferAddressContext) => void;

// Warning: (ae-forgotten-export) The symbol "ICopyDataRecordsRequest" needs to be exported by the entry point index.d.ts
//
// @public (undocumented)
export const copyDataRecords: (terminal: Terminal, req: ICopyDataRecordsRequest) => Promise<undefined>;

// @public
export function createConnectionJson<T = any>(URL: string): IConnection<T>;

// @public
export function createConnectionWs<T = any>(URL: string): IConnection<T>;

// @public
export const escapeRegExp: (string: string) => string;

// @public
export interface IConnection<T> {
    connection$: AsyncIterable<unknown>;
    input$: AsyncIterable<T>;
    output$: NativeSubject<T>;
}

// @public
export interface IResponse<T = void> {
    // (undocumented)
    code: number;
    // (undocumented)
    data?: T;
    // (undocumented)
    message: string;
}

// @public
export interface IService {
}

// Warning: (ae-internal-missing-underscore) The name "IServiceCandidateClientSide" should be prefixed with an underscore because the declaration is marked as @internal
//
// @internal (undocumented)
export interface IServiceCandidateClientSide {
    // (undocumented)
    service_id: string;
    // (undocumented)
    serviceInfo: IServiceInfo;
    // (undocumented)
    terminal_id: string;
    // (undocumented)
    validator: ValidateFunction;
}

// Warning: (ae-internal-missing-underscore) The name "IServiceHandler" should be prefixed with an underscore because the declaration is marked as @internal
//
// @internal (undocumented)
export type IServiceHandler<T extends string = string> = T extends keyof IService ? (msg: ITerminalMessage & Pick<IService[T], 'req'> & {
    method: T;
}, output$: NativeSubject<Omit<ITerminalMessage, 'method' | 'trace_id' | 'source_terminal_id' | 'target_terminal_id'> & Partial<Pick<IService[T], 'res' | 'frame'>>>) => ObservableInput<Omit<ITerminalMessage, 'method' | 'trace_id' | 'source_terminal_id' | 'target_terminal_id'> & Partial<Pick<IService[T], 'res' | 'frame'>>> : (msg: ITerminalMessage, output$: NativeSubject<Omit<ITerminalMessage, 'method' | 'trace_id' | 'source_terminal_id' | 'target_terminal_id'>>) => ObservableInput<Omit<ITerminalMessage, 'method' | 'trace_id' | 'source_terminal_id' | 'target_terminal_id'>>;

// @public
export interface IServiceInfo {
    method: string;
    schema: JSONSchema7;
    service_id?: string;
}

// Warning: (ae-internal-missing-underscore) The name "IServiceInfoServerSide" should be prefixed with an underscore because the declaration is marked as @internal
//
// @internal (undocumented)
export interface IServiceInfoServerSide {
    // (undocumented)
    handler: IServiceHandler;
    // (undocumented)
    options: IServiceOptions;
    // (undocumented)
    serviceInfo: IServiceInfo;
    // (undocumented)
    validator: ValidateFunction;
}

// @public
export interface IServiceOptions {
    concurrent?: number;
    max_pending_requests?: number;
    rateLimitConfig?: {
        count: number;
        period: number;
    };
}

// @public
export interface ITerminalInfo {
    channelIdSchemas?: JSONSchema7[];
    created_at?: number;
    enable_WebRTC?: boolean;
    name?: string;
    serviceInfo?: Record<string, IServiceInfo>;
    // @deprecated
    status?: string;
    subscriptions?: Record<string, string[]>;
    terminal_id: string;
    updated_at?: number;
}

// @public
export interface ITerminalMessage {
    // (undocumented)
    channel_id?: string;
    // (undocumented)
    frame?: unknown;
    // (undocumented)
    method?: string;
    // (undocumented)
    req?: unknown;
    // (undocumented)
    res?: IResponse<unknown>;
    // (undocumented)
    source_terminal_id: string;
    // (undocumented)
    target_terminal_id: string;
    // (undocumented)
    trace_id: string;
}

// @public
export const PromRegistry: Registry;

// @public
export const provideAccountInfo: (terminal: Terminal, accountInfo$: ObservableInput<IAccountInfo>) => void;

// @public
export const providePeriods: (terminal: Terminal, datasource_id: string, usePeriods: (product_id: string, period_in_sec: number) => ObservableInput<IPeriod[]>) => void;

// @public
export const provideTicks: (terminal: Terminal, datasource_id: string, useTicks: (product_id: string) => ObservableInput<ITick>) => void;

// @public
export const publishAccountInfo: (terminal: Terminal, account_id: string, accountInfo$: ObservableInput<IAccountInfo>) => {
    dispose: () => void;
};

// Warning: (ae-forgotten-export) The symbol "IQueryPeriodsRequest" needs to be exported by the entry point index.d.ts
//
// @public (undocumented)
export const queryPeriods: (terminal: Terminal, req: IQueryPeriodsRequest) => Promise<IPeriod[]>;

// Warning: (ae-forgotten-export) The symbol "IQueryDataRecordsRequest" needs to be exported by the entry point index.d.ts
//
// @public (undocumented)
export const readDataRecords: <T extends keyof IDataRecordTypes>(terminal: Terminal, request: IQueryDataRecordsRequest & {
    type: T;
}) => Promise<IDataRecord<IDataRecordTypes[T]>[]>;

// Warning: (ae-forgotten-export) The symbol "IRemoveDataRecordsRequest" needs to be exported by the entry point index.d.ts
//
// @public (undocumented)
export const removeDataRecords: (terminal: Terminal, req: IRemoveDataRecordsRequest) => Promise<void>;

// @public
export const requestSharedKey: (terminal: Terminal, ed25519_public_key: string) => Promise<{
    public_key: string;
    private_key: string;
    remote_public_key: string;
    shared_key: string;
}>;

// @public
export const setupHandShakeService: (terminal: Terminal, private_key: string) => Map<string, string>;

// @public
export class Terminal {
    constructor(host_url: string, terminalInfo: ITerminalInfo, connection?: IConnection<string>);
    // Warning: (ae-forgotten-export) The symbol "TerminalClient" needs to be exported by the entry point index.d.ts
    //
    // (undocumented)
    client: TerminalClient;
    consumeChannel: <T>(channel_id: string) => AsyncIterable<T>;
    dispose$: AsyncIterable<void>;
    dispose(): void;
    // (undocumented)
    host_url: string;
    input$: AsyncIterable<ITerminalMessage>;
    output$: NativeSubject<ITerminalMessage>;
    provideChannel: <T>(channelIdSchema: JSONSchema7, handler: (channel_id: string) => ObservableInput<T>) => {
        dispose: () => void;
    };
    // Warning: (ae-incompatible-release-tags) The symbol "provideService" is marked as @public, but its signature references "IServiceHandler" which is marked as @internal
    provideService: <T extends string>(method: T, requestSchema: JSONSchema7, handler: IServiceHandler<T>, options?: IServiceOptions) => {
        dispose: () => void;
    };
    request<T extends string>(method: T, target_terminal_id: string, req: T extends keyof IService ? IService[T]['req'] : ITerminalMessage['req']): AsyncIterable<T extends keyof IService ? Partial<IService[T]> & ITerminalMessage : ITerminalMessage>;
    requestForResponse<T extends keyof IService>(method: T, req: IService[T]['req']): Promise<Exclude<(Partial<IService[T]> & ITerminalMessage)['res'], undefined>>;
    // (undocumented)
    requestForResponse(method: string, req: ITerminalMessage['req']): Promise<Exclude<ITerminalMessage['res'], undefined>>;
    requestService<T extends keyof IService>(method: T, req: IService[T]['req']): AsyncIterable<Partial<IService[T]> & ITerminalMessage>;
    // (undocumented)
    requestService(method: string, req: ITerminalMessage['req']): AsyncIterable<ITerminalMessage>;
    resolveTargetTerminalIds: (method: string, req: ITerminalMessage['req']) => Promise<string[]>;
    // Warning: (ae-forgotten-export) The symbol "TerminalServer" needs to be exported by the entry point index.d.ts
    //
    // (undocumented)
    server: TerminalServer;
    terminal_id: string;
    // (undocumented)
    terminalInfo: ITerminalInfo;
    terminalInfos$: AsyncIterable<ITerminalInfo[]>;
}

// @public
export const useAccountInfo: (terminal: Terminal, account_id: string) => AsyncIterable<IAccountInfo>;

// @public
export const usePeriod: (terminal: Terminal, datasource_id: string, product_id: string, period_in_sec: number) => AsyncIterable<IPeriod[]>;

// @public (undocumented)
export const useProducts: (terminal: Terminal, datasource_id: string) => AsyncIterable<IProduct[]>;

// @public
export const useTick: (terminal: Terminal, datasource_id: string, product_id: string) => AsyncIterable<ITick>;

// @public (undocumented)
export const writeDataRecords: <T extends keyof IDataRecordTypes>(terminal: Terminal, data: IDataRecord<IDataRecordTypes[T]>[]) => Promise<undefined>;

```
