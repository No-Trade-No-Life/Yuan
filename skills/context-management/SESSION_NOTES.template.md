# 项目会话笔记模板 / Session Notes

> 用途：作为项目的**单一真相源（Single Source of Truth）**，记录：
>
> - 当前目标与背景；
> - 指令与约束（与 AGENTS 联动）；
> - 重要决策与技术债；
> - 最近几轮工作与 TODO；
> - 指令冲突与解决经过。

复制本文件为实际使用的 `codex/SESSION_NOTES.md`（或项目约定路径），再根据项目情况补充内容。

---

## 0. 元信息（Meta）

- **项目名称**：{{PROJECT_NAME}}
- **最近更新时间**：{{YYYY-MM-DD HH:MM}}（由 {{AGENT_NAME 或 人名}} 更新）
- **当前状态标签**：{{探索中 / 实现中 / 重构中 / 修 bug / 暂停 / 阻塞}}

---

## 1. 项目整体目标（High-level Goal）

> 用 2–5 句话描述：这个项目要解决什么问题，为谁服务，以及不做什么。

- {{项目要解决的核心问题}}
- {{目标用户 / 业务场景}}
- {{关键约束，例如性能、成本、安全、兼容性等}}
- {{明确当前阶段“不考虑”的方向（Non-goals）}}

示例（请替换）：

- 搭建一个用于 {{用途}} 的 CLI + Web 服务；
- 需要可以通过 {{Docker / K8s / 本地脚本}} 部署；
- 主打 {{易用性 / 高性能 / 灵活扩展}}。

---

## 2. 指令与约束（Instructions & Constraints）

> 与 `AGENTS.md` 配合使用，专门记录“该怎么做事”的规则变化历史。

### 2.1 长期指令快照

> 这里不是把 AGENTS 全部抄一遍，而是记录当前“对本项目实际生效的关键指令摘要”。

- {{语言与沟通相关指令简述}}
- {{架构与代码相关指令简述}}
- {{安全与风控相关指令简述}}

当 AGENTS 中长期指令更新时，可以在此做概览性同步，保持两边一致。

---

### 2.2 当前阶段指令

> 与“当前阶段的重点目标”配套，说明这一阶段有哪些特别的行为约束。

- {{例如：“本阶段仅重构 service 层，不改 DB schema。”}}
- {{例如：“暂时不做缓存优化，先保证功能正确。”}}

---

### 2.3 临时指令（短期有效）

> 只对少数几轮会话有效的指令，例如：

- {{例如：“本周先不动生产配置，只在测试环境尝试。”}}
- {{例如：“这次会话只整理文档，不改任何代码。”}}

可以定期由人类或某个 Agent 清理过期内容。

---

### 2.4 指令冲突与变更记录

> 当新指令与旧指令冲突时，务必在这里记录“冲突 → 讨论 → 决议”的过程摘要。

记录建议格式：

- {{YYYY-MM-DD}} — 冲突编号 C1
  - 旧指令：{{简述 + 来源位置，例如“AGENTS 2.1 第 3 条”}}
  - 新指令：{{用户或上级新要求}}
  - 冲突点：{{简短描述}}
  - 决议：
    - {{例如：“允许在模块 X 中例外使用 Y，AGENTS 已更新。”}}
  - 相关文件更新：
    - `AGENTS.md`：{{已更新的部分}}
    - `SESSION_NOTES`：{{同步说明的位置}}

> 本小节是配合“上下文与指令管理 Skill”使用的关键位置。

---

## 3. 当前阶段的重点目标（Current Focus）

> 当前这段时期内的重点工作，而非整个项目生命周期目标。
> 对于复杂阶段目标，建议在仓库中维护独立的 `IMPLEMENTATION_PLAN.md`，
> 用于分解阶段、跟踪状态；在本节或第 6/7 节中可链接到该计划文件。

- {{例如：“完成订单创建流程的核心 API 实现”}}
- {{例如：“将监控接入 Prometheus 并加上基础告警”}}
- {{例如：“为已有服务补充集成测试”}}

当阶段目标变化时，在这里更新，并在“重要背景与关键决策”中写明原因。

---

## 4. 重要背景与关键决策（Context & Decisions）

> 用于帮助新加入的 Agent / 人类快速理解：这个项目是怎么走到现在这一步的。

### 4.1 架构 / 模块概览

- 主要模块与目录：
  - `{{path/或模块名}}`：{{职责 / 主要功能}}
  - `{{path/或模块名}}`：{{职责 / 主要功能}}

### 4.2 已做出的关键决策

- [D1] {{决策内容}}

  - 背景：{{为何需要做出该决策}}
  - 方案选择：{{有哪些候选，为什么选了这个}}
  - 影响范围：{{受影响模块 / 使用方}}

- [D2] {{决策内容}}
  - ...

> 如某决策被更新或废弃：
>
> - 在此标注“已被 D# 替代”；
> - 并在“指令与约束”或“冲突记录”中写明变更原因。

### 4.3 已接受的折衷 / 技术债

- {{例如：“为了赶上线，暂时只支持单租户模式，未来需要多租户改造。”}}
- {{例如：“日志输出较简单，后续需要接入集中式日志系统。”}}

---

## 5. 关键文件与模块说明（Files & Modules）

> 列出对当前阶段来说特别关键的文件或目录，方便后续快速定位。

- `{{src/file1}}`：{{主要功能 / 注意事项}}
- `{{src/file2}}`：{{主要功能 / 注意事项}}
- `{{src/feature/}}`：{{该目录下的整体职责}}

如存在自动生成目录（例如 `generated/`），在这里说明能否手动改动，以避免误操作。

---

## 6. 最近几轮工作记录（Recent Sessions）

> 约定：
>
> - 这一节的每一个小标题（`###`）都对应“**已经结束的一轮会话**”（不管是人还是 Agent）；
> - 当前正在进行的这轮会话，请**不要**一边做一边往这里写“计划中/进行中的内容”，
>   而是先写在第 11 节的「当前会话草稿 / Scratchpad」；
> - 当本轮会话真正结束时，再把已经落实的结果整理成一个新的小节，追加到这里。

> 建议采用“最新在前”的倒序记录，每轮工作 1 小节。

### {{YYYY-MM-DD}} — {{AGENT_NAME 或 人名}}

- **本轮摘要**：
  - {{1–3 条，说明本轮实际做了什么（已经完成的事实，而不是计划）}}
- **修改的文件**：
  - `{{file1}}`, `{{file2}}`, ...
- **详细备注**：
  - {{临时绕过、折衷方案、需要后续处理的坑}}
  - {{是否有指令变更，若有请关联到 2.4 中的条目编号}}
- **运行的测试 / 检查**：
  - 命令：`{{例如：npm test / pytest / go test ./...}}`
  - 结果：{{全部通过 / 某些失败及简单原因}}

> 新增记录时，尽量控制字数，但要确保下一位可以看懂。

（可按时间继续追加多个记录小节）

---

## 7. 当前 TODO / 任务列表（Tasks & TODO）

> 使用勾选框，方便所有人一眼看到项目进度和优先级。

### 7.1 高优先级（下一轮优先处理）

- [ ] {{任务 1 —— 尽量具体，可在一轮会话内完成}}
- [ ] {{任务 2}}
- [ ] {{任务 3}}

### 7.2 中优先级 / 待排期

- [ ] {{任务 4 —— 可稍后处理}}
- [ ] {{任务 5}}

### 7.3 想法 / Nice-to-have

- [ ] {{想法 1 —— 若时间充裕可以尝试的改进}}
- [ ] {{想法 2}}

> 规则：
>
> - 完成的任务打勾 `[x]` 而不是直接删除；
> - 新任务按优先级归类；
> - 每位 Agent 在结束前至少更新“高优先级”区域。

---

## 8. 风险点 / 容易踩坑的地方（Risks & Gotchas）

> 记录那些“不提醒就很容易翻车”的内容。

- **风险 1**：{{简述}}

  - 影响：{{一旦出现会有什么后果}}
  - 背景：{{为什么目前会这样}}
  - 建议：{{如何避免 / 触发后怎么处理}}

- **风险 2**：{{...}}

包括但不限于：

- 外部依赖（第三方服务 / API / 凭证）；
- 性能瓶颈；
- 部署 / 运维注意事项；

---

## 9. 尚未解决的问题（Open Questions）

> 记录“还没想清楚 / 没拍板”的事项，方便后续 Agent 或人类继续思考。

- **问题 1**：{{问题描述}}

  - 当前思路：{{已有分析 / 尝试过什么}}
  - 备选方案：
    - 方案 A：{{简单利弊}}
    - 方案 B：{{简单利弊}}

- **问题 2**：{{...}}

> 当问题被解决时：
>
> - 在这里标注“已解决（见 D# 决策 / C# 冲突记录）”；
> - 并在相应章节（决策 / 指令）中补充最终结论。

---

## 10. 下一位 Agent 的建议行动（Next Steps for Next Agent）

> 这一节是专门给“接班人”看的，用尽量简短但具体的步骤说明“接下来该做什么”。

建议下一位 Agent 从这里开始：

1. {{步骤 1 —— 如：“先阅读第 2 节指令与约束，以及（如存在）`IMPLEMENTATION_PLAN.md` 当前阶段状态。”}}
2. {{步骤 2 —— 如：“从 7.1 列表顶部尚未完成的任务开始执行。”}}
3. {{步骤 3 —— 如：“在实现前，阅读 `src/xxx.ts` 的注释和相关设计决策 D#。”}}
4. {{步骤 4 —— 如：“完成后更新第 6/7/8/9/10 节相关内容。”}}

如项目当前处于阻塞状态，请在此说明：

- 阻塞点是什么（例如缺少 API key、等待某方确认方案等）；
- 预期由谁/什么解除阻塞；
- 阻塞解除后，首要任务是什么。

---

## 11. 当前会话草稿 / Scratchpad（仅本轮使用）

> 这一节用来区分“**当前会话正在进行中的内容**”和“之前轮次已经结算完的内容”。
>
> 约定：
>
> - 当前这轮会话的临时想法、还在进行中的步骤、尚未确认的结论，先写在这里；
> - 在本轮会话**结束前**：
>   - 把已经落实的部分“结算”到上面的正式章节（6/7/8/9/10）；
>   - 然后清空或归档本节内容，避免下一轮 Agent 搞不清哪些是旧草稿；
> - 下一轮 Agent 如果在这里看到残留内容，应当：
>   - 把它当作“上一轮遗留的未结算草稿”，
>   - 先判断哪些需要整理成正式记录或 TODO，再清空本节。

### 当前会话（进行中） — {{YYYY-MM-DD HH:MM}} — {{AGENT_NAME 或 人名}}

> Agent 在本轮里，可以在这个小节下随意记当前会话相关的草稿信息。
> 比如：

- 计划中的步骤（尚未执行/尚未全部执行完）：

  - [ ] {{步骤 1}}
  - [ ] {{步骤 2}}

- 正在尝试的方案 / 中间结论：

  - {{例如：尝试用某个库实现，遇到什么问题}}

- 待确认的问题：
  - {{例如：需要人类决策的点 / 尚不确定的设计}}

> 本轮结束时的“结算步骤”建议：
>
> 1. 把已经真正完成的内容，整理进第 6 节的“最近几轮工作记录”中新建的小节；
> 2. 把尚未完成但仍然必要的工作，转成第 7 节的 TODO 项；
> 3. 把稳定下来的风险 / 问题 / 结论，分别写入第 8 / 9 节；
> 4. 然后清空或注释掉本小节，避免下一轮误以为这些是“当前会话”。
