# 交易中的基础数学

:::info[预备知识]
阅读本文需要具备**基础代数**知识。
在阅读本文之前，请确保您能理解[这些数学概念](https://zh.wikipedia.org/wiki/%E5%88%9D%E7%AD%89%E4%BB%A3%E6%95%B8)。

理解基础数学概念非常重要，因为交易是建立在这些概念之上的。

现在，让我们一步一步地构建坚实的交易概念体系。
:::

交易是买卖产品的过程。产品可以是任何可以交易的东西，如股票、债券、外汇、商品、加密货币、期权等。

我们通常用自己的钱来购买产品，然后以更高的价格卖出以获利。这是最基本的交易方法。

定义从 $x$ 到 $y$ 在时间 $t$ 的价格表示：$P(x, y, t) = \frac{\text{单位价值}(x, t)}{\text{单位价值}(y, t)}$

显然，我们有 $P(x, y, t) \times P(y, x, t) = P(x, x, t) = 1$

并且我们有 $P(x, y, t) \times P(y, z, t) = P(x, z, t)$

遵循等价交换原则：

$$
\text{单位价值}(x, t) \times \text{数量}(x) = \text{单位价值}(y, t) \times \text{数量}(y)
$$

我们可以推导出以下公式：

$$
\text{数量}(y) = \frac{\text{单位价值}(x, t)}{\text{单位价值}(y, t)} \times \text{数量}(x, t) = P(x, y, t) \times \text{数量}(x)
$$

上述公式是计算交易数量的基础。

## 交易现货

:::info[示例 - 股票现货]
例如，如果你想购买 100 股苹果股票，价格为 $P(\text{AAPL}, \text{USD}, t_1) = 100$，那么你需要支付 $100 \times 100 = 10000$ 美元。

如果你想卖出 100 股苹果股票，价格为 $P(\text{AAPL}, \text{USD}, t_2) = 110$，那么你将获得 $110 \times 100 = 11000$ 美元。

最终你将获得 $11000 - 10000 = 1000$ 美元的利润。

| 时间     | $t_1$  | $t_2$  | 总结  |
| -------- | ------ | ------ | ----- |
| 美元     | -10000 | +11000 | +1000 |
| 苹果股票 | +100   | -100   | 0     |

交易的神奇之处在于你可以不生产任何东西就能赚钱。你可以通过买卖产品来赚钱。

所有衍生金融工具（期货和期权）都是基于现货的。
:::

为了符号化上述过程，我们可以使用以下公式：

如果我们的货币是 $A$，我们在时间 $t_1$ 买入 $V$ 数量的 $B$，并在时间 $t_2$ 卖出 $V$ 数量的 $B$，那么我们将获得以下利润：

| 时间 | $t_1$                    | $t_2$                    | 总结                                     |
| ---- | ------------------------ | ------------------------ | ---------------------------------------- |
| A    | $-V \times P(B, A, t_1)$ | $+V \times P(B, A, t_2)$ | $V \times (P(B, A, t_2) - P(B, A, t_1))$ |
| B    | $+V$                     | $-V$                     | 0                                        |

<a name="formula-1"></a>

因此，我们可以得到公式 1：

$$
\text{PnL} = V \times (P(B, A, t_2) - P(B, A, t_1))
$$

:::info[示例 - 卖空]
假设你想卖空 100 股苹果股票，价格为 $P(\text{AAPL}, \text{USD}, t_1) = 100$，那么你将获得 $100 \times 100 = 10000$ 美元。

如果你想买入 100 股苹果股票，价格为 $P(\text{AAPL}, \text{USD}, t_2) = 90$，那么你需要支付 $90 \times 100 = 9000$ 美元。

最终你将获得 $10000 - 9000 = 1000$ 美元的利润。

实际上，你需要**借入**100 股苹果股票从交易所，然后在 $t_1$ 卖出，再在 $t_2$ 买入，最后归还给交易所。

| 时间     | $t_1$  | $t_2$ | 总结  |
| -------- | ------ | ----- | ----- |
| 美元     | +10000 | -9000 | +1000 |
| 苹果股票 | -100   | +100  | 0     |

令 $V = -100, P(\text{AAPL}, \text{USD}, t_1) = 100, P(\text{AAPL}, \text{USD}, t_2) = 90$，[公式 1](#formula-1) 仍然有效。
:::

## 交易合约

如果我们最终将所有产品卖回我们的货币，为什么不直接交易合约呢？

是时候引入**合约**的概念了。

合约是一种金融工具，是现货的衍生品。当你买卖合约时，你实际上是在买卖现货的所有权。因此，合约的盈亏是基于现货的。

也许你听说过期货、期权、差价合约（CFD）等。它们都是合约。

- **交割合约**是一种有到期日的合约。期货和期权是交割合约。当合约到期时，合约将被结算，合约将以到期时的现货价格结算。你也可以选择在到期日前关闭合约。你也可以选择在到期日前展期合约。你也可以选择在到期日后交割现货。
- **永续合约**是一种没有到期日的合约。CFD 是一种永续合约。你可以选择在任何时候关闭合约。你永远不能选择通过现货产品交割合约。永续合约通常每日结算，结算价格是结算时的现货价格。

合约有一个**价值尺度**。例如，如果价值尺度是 100，当你购买 1 份合约时，你拥有 100 份现货的所有权。

:::info[示例 - 商品期货合约]
例如，你有一个美元账户，你想购买 1 份黄金期货合约，合约基于黄金，一份合约价值为 100 盎司。市场上只显示黄金期货的价格 $P(\text{Gold Future}, \text{USD}, t)$。

当你购买 1 份黄金期货合约时，你拥有 100 盎司黄金的所有权。

假设 $V=100$，如果我们交易黄金现货，那么我们将获得以下利润：

$$
\text{PnL} = 100 \times (P(\text{Gold Spot}, \text{USD}, t_2) - P(\text{Gold Spot}, \text{USD}, t_1))
$$

众所周知，黄金期货的价格通常非常接近黄金现货，但并不相同。

实际上，你购买了 1 份黄金期货合约。也许以下公式更合理：

$$
\text{PnL} = 1 \times (P(\text{Gold Future}, \text{USD}, t_2) - P(\text{Gold Future}, \text{USD}, t_1))
$$

但如果我们将黄金期货的价格视为黄金现货的 100 倍，这将非常奇怪且反直觉。

因此，我们需要引入**价值尺度的倍数**。

$$
\text{PnL} = 1 \times \text{value scale} \times (P(\text{Gold Future}, \text{USD}, t_2) - P(\text{Gold Future}, \text{USD}, t_1))
$$

:::

:::info[示例 - 期权合约]
期权是一种合约，赋予你在特定价格买入或卖出产品的权利。
期权的买方有权利但没有义务买入或卖出产品。期权的卖方有义务买入或卖出产品。
期权通常分为两种类型：看涨期权和看跌期权。
期权有独立的价格，由市场供需关系决定。
因此，其盈亏公式类似于商品期货。

例如，你有一个美元账户，你想购买 1 份苹果股票的看涨期权，行权价为 200 美元，合约基于苹果股票，一份合约价值为 100 股。市场上只显示苹果股票看涨期权的价格 $P(\text{AAPL Call@200 Option}, \text{USD}, t)$。

当你购买 1 份苹果股票看涨期权时，你有权以每股 200 美元的价格购买 100 股苹果股票。

$$
\text{PnL} = 1 \times 100 \times (P(\text{AAPL Call@200 Option}, \text{USD}, t_2) - P(\text{AAPL Call@200 Option}, \text{USD}, t_1))
$$

:::

:::info[示例 - 债券现货/期货]
债券是一种合约，赋予你在未来特定时间收到固定金额的权利。
债券的买方有权利但没有义务收到这笔钱。债券的卖方有义务支付这笔钱。
债券通常分为两种类型：附息债券和零息债券。
债券有独立的价格，由市场供需关系决定。
因此，其盈亏公式类似于商品期货。

例如，你有一个美元账户，你想购买 1 份美国 10 年期债券，合约基于美元，一份合约价值为 100,000 美元。市场上只显示美国 10 年期债券的价格 $P(\text{US 10Y Bond}, \text{USD}, t)$。

当你购买 1 份美国 10 年期债券时，你有权在 10 年后收到 100,000 美元。

债券的价格通常在 100 左右。因此，债券的价值尺度为 1000（1 份合约价值的 1%）。

$$
\text{PnL} = 1 \times 1000 \times (P(\text{US 10Y Bond}, \text{USD}, t_2) - P(\text{US 10Y Bond}, \text{USD}, t_1))
$$

:::

<a name="formula-2"></a>

非常棒，我们可以得到公式 2：

$$
\text{PnL} = V \times \text{Value Scale} \times (P(B, A, t_2) - P(B, A, t_1))
$$

我们可以将现货视为一种特殊的合约，现货的价值尺度为 1。

## 交易外币

我们可能会遇到这样的情况：我们想购买一种产品，但该产品以另一种货币报价，或者该产品只能以另一种货币交易。

例如：

- 外汇差价合约
- 加密货币的币本位合约（又称反向合约）
- 用本币购买外国股票

它们是通过链式机制交易的。

1. 开始时，买入
   1. 用本币购买中间货币。
   2. 用中间货币购买产品。
2. 结束时，卖出
   1. 卖出产品并获得中间货币。
   2. 卖出中间货币并获得本币。

这看起来很复杂。但我们可以简化它。

我们可以简单地假装我们有足够的中间货币，然后直接购买产品。最后将中间货币兑换回本币。

:::info[示例 - 购买外国股票]
例如，你有一个美元账户，你想购买一些腾讯股票，该股票基于港元。市场上只显示腾讯股票的价格 $P(\text{Tencent}, \text{HKD}, t)$ 和美元/港元的价格 $P(\text{USD}, \text{HKD}, t)$。

首先，计算以港元计的利润：

$$
\text{PnL in HKD} = V \times (P(\text{Tencent}, \text{HKD}, t_2) - P(\text{Tencent}, \text{HKD}, t_1))
$$

然后，将港元利润兑换为美元：

$$
\text{PnL in USD} = \text{PnL in HKD} \times P(\text{HKD}, \text{USD}, t_2) \\
                  = \text{PnL in HKD} \times \frac{1}{P(\text{USD}, \text{HKD}, t_2)} \\
                  = V \times (P(\text{Tencent}, \text{HKD}, t_2) - P(\text{Tencent}, \text{HKD}, t_1)) \times \frac{1}{P(\text{USD}, \text{HKD}, t_2)}
$$

唯一的区别是我们需要在最后将港元利润兑换为美元。

如果我们需要将利润从美元兑换为另一种货币怎么办？只需在最后将利润从美元兑换为另一种货币。这就是链式机制的神奇之处。

:::

因此，我们推导出以下公式 3：

$$
\text{PnL} = V \times \text{Value Scale} \times (P(B, C, t_2) - P(B, C, t_1)) \times P(C, A, t_2)
$$

公式 2 是公式 3 的一个特例，当 $A = C$ 时。

:::info[示例 - 外汇差价合约（直接汇率）]
例如，你有一个美元账户，你想购买 1 份欧元/美元合约，合约基于欧元，一份合约价值为 100,000 欧元。市场上只显示欧元/美元的价格 $P(\text{EUR}, \text{USD}, t)$。

当你购买 1 份欧元/美元合约时，意味着你卖出一些美元并购买 100,000 欧元。

令 A = USD, B = EUR, C = USD, V = 1, Value Scale = 100000：

$$
\text{PnL} = 1 \times 100000 \times (P(\text{EUR}, \text{USD}, t_2) - P(\text{EUR}, \text{USD}, t_1)) \times P(\text{USD}, \text{USD}, t_2) \\
    = 100000 \times (P(\text{EUR}, \text{USD}, t_2) - P(\text{EUR}, \text{USD}, t_1))
$$

:::

:::info[示例 - 外汇差价合约（间接汇率）]
例如，你有一个美元账户，你想购买 1 份美元/日元合约，合约基于美元，一份合约价值为 100,000 美元。市场上只显示美元/日元的价格 $P(\text{USD}, \text{JPY}, t)$。

当你购买 1 份美元/日元合约时，意味着你用日元购买一些美元，然后购买 100,000 美元。

令 A = USD, B = USD, C = JPY, V = 1, Value Scale = 100000：

$$
\text{PnL} = 1 \times 100000 \times (P(\text{USD}, \text{JPY}, t_2) - P(\text{USD}, \text{JPY}, t_1)) \times P(\text{JPY}, \text{USD}, t_2) \\
    = 100000 \times (P(\text{USD}, \text{JPY}, t_2) - P(\text{USD}, \text{JPY}, t_1)) \times \frac{1}{P(\text{USD}, \text{JPY}, t_2)}
$$

:::
:::info[示例 - 外汇差价合约（交叉汇率）]
例如，你有一个美元账户，你想购买一份英镑/日元合约，合约基于英镑，一份合约价值为 100,000 英镑。但市场上只显示英镑/日元的价格 $P(\text{GBP}, \text{JPY}, t)$ 和英镑/美元的价格 $P(\text{GBP}, \text{USD}, t)$。

当你购买 1 份英镑/日元合约时，意味着你卖出一些日元，然后购买 100,000 英镑。

令 A = USD, B = GBP, C = JPY, V = 1, Value Scale = 100000：

$$
\text{PnL} = 1 \times 100000 \times (P(\text{GBP}, \text{JPY}, t_2) - P(\text{GBP}, \text{JPY}, t_1)) \times P(\text{JPY}, \text{USD}, t_2) \\
    = 100000 \times (P(\text{GBP}, \text{JPY}, t_2) - P(\text{GBP}, \text{JPY}, t_1)) \times \frac{P(\text{GBP}, \text{USD}, t_2)}{P(\text{GBP}, \text{JPY}, t_2)}
$$

:::

:::info[示例 - 加密货币的币本位合约]
例如，你有一个比特币账户，你想购买 1 份比特币/美元合约，一份合约价值为 100 美元。市场上只显示比特币/美元的价格 $P(\text{BTC}, \text{USD}, t)$。

当你购买 1 份比特币/美元合约时，意味着你卖出 100 美元，然后购买一些比特币。

令 A = BTC, B = BTC, C = USD, $V = \frac{1}{P(\text{BTC}, \text{USD}, t_1)}$, Value Scale = 100：

$$
\text{PnL} = \frac{1}{P(\text{BTC}, \text{USD}, t_1)} \times 100 \times (P(\text{BTC}, \text{USD}, t_2) - P(\text{BTC}, \text{USD}, t_1)) \times P(\text{USD}, \text{BTC}, t_2) \\
    = \frac{100 \times (P(\text{BTC}, \text{USD}, t_2) - P(\text{BTC}, \text{USD}, t_1))}{P(\text{BTC}, \text{USD}, t_2) \times P(\text{BTC}, \text{USD}, t_1)}
$$

看起来很奇怪，V 是一个关于价格的公式。

通常，合约的价值尺度是一个与 B 相关的常数。但在这种情况下，合约的价值尺度与 C 相关。

在这种情况下，我们需要引入一个新的概念：**价值尺度单位**。

合约的价值单位是价值尺度的单位。例如，比特币/美元的价值尺度单位是美元。

$$
\text{PnL} = 1 \times 100 \times P(\text{USD}, \text{BTC}, t_1) \times \\
             (P(\text{BTC}, \text{USD}, t_2) - P(\text{BTC}, \text{USD}, t_1)) \times P(\text{USD}, \text{BTC}, t_2)
$$

:::

## 总结

最后，我们可以得到最终的通用公式：

$$
\text{PnL} = \text{Volume} \times \text{Value Scale} \times (P(B, C, t_2) - P(B, C, t_1)) \\
                      \times P(C, A, t_2) \times P(\text{Value Scale Unit}, B, t_1)
$$

其中 B 是你想购买的产品，C 是你想用来购买 B 的货币，A 是你拥有的保证金货币。Volume 是你想交易的合约数量，买入为正，卖出为负。价值尺度单位可以是 B 或 C，取决于合约的规格。
