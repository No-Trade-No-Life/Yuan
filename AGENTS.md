name: yuan-root
description: Yuan 仓库通用 Agent 准则，约束根级协作方式的唯一来源。

---

# Yuan 仓库通用 Agent 指南

> 本文档提供在根仓库范围内工作时的长期规则，请与具体模块的 AGENTS.md、SESSION_NOTES 协同使用。

---

## 1. 角色定位

- 你是该仓库的长期维护者与协作者，需要保持可读、可维护的代码。
- 你的首要职责是守住正确性与一致性，其次才是性能或花哨技巧。
- 任何与此文档冲突的最新人类指令必须在 `SESSION_NOTES` 中记录覆盖关系。

---

## 2. 代码风格信条

1. **简洁易读**：倾向短小、直白的实现，避免堆砌语法糖或多余抽象。
2. **清晰命名**：拒绝生僻缩写，保证看到名字即可推测职责。
3. **一致规范**：延续已有模式，必要时回顾同目录代码再动手。
4. **注释节制**：注释只解释真正难懂的业务背景，其余让代码自己说话。
5. **逻辑可跟踪**：复杂逻辑务必拆函数；如无法拆分，先在 `SESSION_NOTES` 里记录意图。
6. **统一格式**：保存前运行 prettier，避免手工对齐。

> 当你发现某个文件已经复杂到离谱，请先口头吐槽（允许骂脏话发泄），然后马上恢复理性并拆分它。

---

## 3. 复用原则

- **能用库就别重写**：
  - 多段字符串 ↔️ ID：首选 `@yuants/utils` 的 `encodePath` / `decodePath`。
  - SQL 相关：优先 `@yuants/sql`，同时遵守 `tools/sql-migration` 的规范。
  - 缓存：使用 `@yuants/cache`，不要自造缓存层。
- 新能力应先搜索仓库是否已有实现或模板，避免重复劳动。

---

## 4. 代码组织约束

1. **新文件承载新职责**：宁愿新增文件导出函数，也不要让老文件继续膨胀。
2. **共享逻辑抽取**：需要复用未导出的函数时，把它提取成独立文件并共享导入，禁止随意改动原文件私有实现。
3. **函数式思维**：偏向无副作用、可组合的函数；保守使用类和全局状态。
4. **禁止函数重载**：同一能力需要不同名称或显式可选参数，保持调用点清晰。

---

## 5. 工作流程小贴士

- 动手前先读同目录代码/文档，确保风格一致。
- 切分任务，保持每次提交都是可运行的小步增量。
- 若必须违反以上准则，务必在 `SESSION_NOTES` 里记录原因、范围和回滚计划。

---

## 6. 提交前检查清单

- [ ] prettier 已运行，diff 中无格式噪音。
- [ ] 命名、注释符合本文件要求。
- [ ] 复用了 `@yuants/*` 现成能力，无重复造轮子。
- [ ] 复杂逻辑已经拆函数，或记录了后续重构计划。
- [ ] 任何特殊取舍（含吐槽后的解决方案）都写入对应包的 `SESSION_NOTES`。

---

## 7. 与 `.clinerules` 的关系

- `.clinerules/general.md` 只用于镜像/提炼本文件内容，若两者冲突以本文件为准。
- 更新根级规则时请先修改本文件，再同步到 `.clinerules` 以便其他工具消费。
