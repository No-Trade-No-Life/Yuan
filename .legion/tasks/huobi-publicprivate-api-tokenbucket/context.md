# Huobi public/private API tokenBucketï¼šæŒ‰ä¸šåŠ¡ä¸æ¥å£ç±»å‹ä¸»åŠ¨é™æµ - ä¸Šä¸‹æ–‡

## ä¼šè¯è¿›å±• (2025-12-26)

### âœ… å·²å®Œæˆ

- å·²ç¡®è®¤ tokenBucket å®šä¹‰ä¸ä½¿ç”¨ä½ç½®ï¼špublic-api/private-api åœ¨æ¨¡å—åˆå§‹åŒ–é˜¶æ®µ create å›ºå®š bucketï¼ˆIP ç»´åº¦ï¼‰ï¼Œprivate-api æŒ‰ `access_key` åŠ¨æ€ create per-UID bucketï¼›è¯·æ±‚ä¾§åª `acquireSync(1)`ï¼ˆä¸æ•è· token ä¸è¶³å¼‚å¸¸ï¼‰
- å·²è°ƒæ•´å®ç°ä¸ºâ€œè°ƒç”¨ç‚¹å†™æ­»ï¼Œä¸åšè¿è¡Œæ—¶è¯†åˆ«â€ï¼špublic/private éƒ½æä¾›å›ºå®šçš„ request helperï¼ˆæŒ‰ business + interfaceTypeï¼‰ï¼Œexported API ç›´æ¥é€‰ç”¨å¯¹åº” helper
- å·²åœ¨ plan.md å†™æ¸… bucket é€‰æ‹©çŸ©é˜µï¼ˆä¸šåŠ¡çº¿ Ã— æ¥å£ç±»å‹ â†’bucketï¼‰ä¸å¯å¤åˆ¶ç¤ºä¾‹ï¼ˆåŒ…å«â€œglobal + business åŒæ¡¶æ‰£å‡â€çš„ç­–ç•¥ï¼‰
- å·²åœ¨ `publicRequest` / `privateRequest` ä¸­æ¥å…¥ `scopeError + acquireSync(1)` å¹¶è¡¥é½ bucketId å‘½åï¼ˆä¾¿äºæ’éšœï¼‰
- å·²æ–°å¢æœ€å°å•æµ‹ï¼š`apps/vendor-huobi/src/api/public-api.rateLimit.test.ts`ã€`apps/vendor-huobi/src/api/private-api.rateLimit.test.ts`
- å·²éªŒè¯ï¼ˆapps/vendor-huobiï¼‰ï¼š`npx tsc --noEmit --project tsconfig.json`ã€`npx heft test --clean`

### ğŸŸ¡ è¿›è¡Œä¸­

- (æš‚æ— )

### âš ï¸ é˜»å¡/å¾…å®š

(æš‚æ— )

---

## å…³é”®æ–‡ä»¶

- `apps/vendor-huobi/src/api/public-api.ts`: publicRequestï¼ˆå°†æ¥å…¥ market/non-market + business bucketï¼‰
- `apps/vendor-huobi/src/api/private-api.ts`: privateRequestï¼ˆå°†æ¥å…¥ trade/query + business bucketï¼‰
- `.legion/tasks/huobi-publicprivate-api-tokenbucket/plan.md`: bucket é€‰æ‹©çŸ©é˜µä¸ç¤ºä¾‹
- `apps/vendor-huobi/src/api/public-api.rateLimit.test.ts`: public bucket è·¯ç”±æœ€å°éªŒè¯
- `apps/vendor-huobi/src/api/private-api.rateLimit.test.ts`: private bucket è·¯ç”±æœ€å°éªŒè¯

---

## å…³é”®å†³ç­–

| å†³ç­–                                                                                                                                  | åŸå›                                                                                                                      | æ›¿ä»£æ–¹æ¡ˆ                                                             | æ—¥æœŸ       |
| ------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------- | ---------- |
| å¯¹â€œäº¤å‰²/å¸æœ¬ä½æ°¸ç»­/U æœ¬ä½åˆ†å¼€é™é¢‘â€ä¸â€œå…±äº«æ€»é¢åº¦â€ä¸¤ç§å£å¾„åŒæ—¶æ»¡è¶³ï¼šå¯¹è¡Œæƒ…ç±»ä¸ç§æœ‰ trade/query åŒæ—¶æ‰£å‡ global bucket + business bucket | ç”¨æˆ·éœ€æ±‚è¦æ±‚ä¸šåŠ¡çº¿æ‹†åˆ†ï¼›é™é¢‘æè¿°åˆå­˜åœ¨â€œæ€»é¢åº¦å…±äº«â€çš„å£å¾„ï¼›åŒæ¡¶æ‰£å‡å¯åŒæ—¶ä¿è¯ä¸è¶…æ€»é‡ã€ä¹Ÿä¿ç•™ä¸šåŠ¡ç»´åº¦å¯è§‚æµ‹æ€§             | åªæ‰£ globalï¼ˆä¸åšä¸šåŠ¡æ‹†åˆ†ï¼‰ï¼›æˆ–åªæ‰£ businessï¼ˆå¯èƒ½ç»•è¿‡æ€»é‡å…±äº«ä¸Šé™ï¼‰ | 2025-12-26 |
| ä¸åšæ— è°ƒç”¨ç‚¹çš„é¢„ç•™ï¼ˆswap/contractï¼‰                                                                                                   | å½“å‰ vendor-huobi å®é™…åªè¦†ç›– spot ä¸ linear-swapï¼›ä¿ç•™æœªç”¨åˆ†æ”¯ä¼šè¯¯å¯¼ç»´æŠ¤è€…ï¼Œä¸”å®¹æ˜“è®©æ–‡æ¡£ä¸ä»£ç â€œçœ‹èµ·æ¥æ”¯æŒä½†å®é™…ä¸Šæ²¡è¦†ç›–â€ | ä¿ç•™ /swap- /contract- çš„ path é¢„ç•™åˆ†æ”¯ä¸ bucketId                   | 2025-12-26 |
| ä¸åšè¿è¡Œæ—¶è¯†åˆ«ï¼ˆå¼€é—­åŸåˆ™ï¼‰ï¼šåœ¨è°ƒç”¨ç‚¹æ˜¾å¼é€‰æ‹© request helper                                                                           | æ–°å¢ä¸šåŠ¡/æ¥å£ç±»å‹æ—¶ï¼Œåªéœ€è¦æ–°å¢å¯¹åº” helper ä¸è°ƒç”¨ç‚¹å¼•ç”¨ï¼Œä¸éœ€è¦å›å¤´æ”¹ä¸€ä¸ªâ€œåˆ†ç±»å™¨â€ä»è€Œç‰µåŠ¨å¤§é‡å·²æœ‰é€»è¾‘                    | åœ¨ request å†…é€šè¿‡ api_root/path/method è‡ªåŠ¨è¯†åˆ«                      | 2025-12-26 |

---

## å¿«é€Ÿäº¤æ¥

**ä¸‹æ¬¡ç»§ç»­ä»è¿™é‡Œå¼€å§‹ï¼š**

1. æ ¡éªŒâ€œè¡Œæƒ…ç±» market dataâ€çš„å£å¾„æ˜¯å¦éœ€è¦åŒ…å«æ›´å¤šæ¥å£ï¼ˆä¾‹å¦‚æ·±åº¦/èšåˆè¡Œæƒ…/æº¢ä»·æŒ‡æ•°/é¢„æµ‹èµ„é‡‘è´¹ç‡ K çº¿ç­‰ï¼‰ï¼›å¦‚éœ€è¦ï¼Œè¡¥å…… `isPublicMarketDataRequest` çš„è§„åˆ™
2. è‹¥åç»­è¦æ¥å…¥å¸æœ¬ä½æ°¸ç»­/äº¤å‰²åˆçº¦ï¼šä¸è¦â€œé¢„ç•™â€ï¼Œè€Œæ˜¯åœ¨çœŸæ­£æ–°å¢è°ƒç”¨ç‚¹æ—¶ç›´æ¥æ–°å¢å¯¹åº” request helper + æœ€å°æµ‹è¯•
3. å¦‚éœ€æ›´ç»†åˆ†ï¼ˆä¾‹å¦‚ trade/query ä¹‹å¤–çš„å­ç±»ï¼‰ï¼Œåœ¨ plan.md è¡¥å……æ–°çš„åˆ¤å®šè§„åˆ™å¹¶åŠ æœ€å°æµ‹è¯•

**æ³¨æ„äº‹é¡¹ï¼š**

- tokenBucket ç¬¬ä¸€æ¬¡è°ƒç”¨æ˜¯ createï¼šä¿æŒ bucket å®šä¹‰åœ¨æ¨¡å—é¡¶å±‚ï¼›è¯·æ±‚ä¾§åªè°ƒç”¨ `acquireSync(1)`
- `swap_cross_openorders` / `swap_cross_position_info` å±äºâ€œæŸ¥è¯¢æ¥å£ä½†ä½¿ç”¨ POSTâ€ï¼Œéœ€è¦ä» trade è§„åˆ™é‡Œæ’é™¤

---

_æœ€åæ›´æ–°: 2025-12-26 11:20 by Codex_
