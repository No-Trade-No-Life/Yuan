# 实现计划模板（IMPLEMENTATION_PLAN.md）

> 用途：当某个功能/重构/问题较复杂时，用本文件把工作拆分为 3–5 个阶段，
> 让人类和 Agent 在多轮会话中有一个清晰的路线图和“完成定义”。

## 元信息（Meta）

- 计划名称：{{例如：订单创建流程重构}}
- 关联 Issue / 需求：{{#123 / PR 链接 / 文档链接}}
- 创建时间：{{YYYY-MM-DD}}
- 最近更新时间：{{YYYY-MM-DD}}（由 {{人名或 Agent 名}} 更新）

---

## 阶段规划（Stages）

> 建议将复杂工作拆成 3–5 个阶段，每个阶段都有明确的目标、可验证的成功标准和对应测试。

### Stage 1: {{阶段名称，如“梳理现有流程并补充测试”}}

**Goal（目标）**：

- {{本阶段要交付的具体成果}}

**Success Criteria（成功标准）**：

- {{可验证的结果，例如“关键路径覆盖率达到 X%”}}

**Tests（需要的测试）**：

- {{具体要新增/运行的测试用例或命令}}

**Status（状态）**：

- Not Started | In Progress | Complete

---

### Stage 2: {{阶段名称}}

**Goal**：

- {{...}}

**Success Criteria**：

- {{...}}

**Tests**：

- {{...}}

**Status**：

- Not Started | In Progress | Complete

---

### Stage 3: {{阶段名称}}

（按需增加 Stage 4 / Stage 5）

---

## 实现流程建议（Implementation Flow）

> 每个阶段内部的工作流推荐如下：

1. **Understand / 理解现状**

   - 查阅 `SESSION_NOTES` 中相关背景和决策；
   - 阅读与本阶段相关的代码和已有实现；
   - 找到 2–3 个“类似功能”的实现作为参考。

2. **Test / 测试优先（尽可能 TDD）**

   - 先写或补充测试（让测试先红 red）；
   - 确认测试能准确暴露当前缺陷或缺失功能。

3. **Implement / 实现**

   - 写最少量的代码让测试变绿（green）；
   - 优先选择“无花活”的直接方案。

4. **Refactor / 重构**

   - 在测试全部通过的前提下，整理结构、抽取函数；
   - 坚持单一职责，避免过早抽象。

5. **Commit / 提交**
   - 提交前：
     - 确认能编译/构建通过；
     - 运行必要的测试/检查；
     - 自行审阅 diff；
   - 提交信息说明：
     - “为什么要改”（why）；
     - 可以附带对应 Stage/Issue 编号。

---

## Definition of Done（完成定义）

> 当你认为“这个实现计划可以收尾了”，请至少满足：

- [ ] 本文件中所有 Stage 的 `Status` 均为 `Complete`
- [ ] 所有承诺的测试已编写并通过
- [ ] 代码符合项目约定的风格与架构原则
- [ ] 没有未解释的 `TODO`（或者都关联到了具体 Issue）
- [ ] `SESSION_NOTES` 已更新：
  - 记录本计划最终完成情况；
  - 如有遗留技术债/风险，已写入对应章节。
